// check trial-block height and add padding from aside
function fixedTrial() {
  var item = $('.js-fixedItem'),
      parent = $('.rs-sidebar'),
      itemHeight = item.height();

  parent.css({"padding-bottom" : itemHeight});
};
fixedTrial();

$(window).resize(function() {
  fixedTrial();
});

// Sidebar triggers
function sidebarTrigger() {
  var triggerLink = $('.js-sidebarTrigger'),
      backLink = $('.js-sidebarBack'),
      sidebarWrap = $('.sidebars-wrap'),
      dragdrop = $('#sidebar-dragdrop');


  $('.sidebar-container').on('click', '.js-sidebarTrigger', function(e) {
    e.preventDefault();

    triggerID = $(this).attr('data-link');

    $(triggerID).addClass('is-show');
    $(triggerID).niceScroll({
      cursorborderradius: "0px",
      cursorborder : false,
      cursorcolor:"#000000",
      cursoropacitymax: 0.30,
      horizrailenabled: false,
      smoothscroll: false,
      nativeparentscrolling: false
    }).resize();
    sidebarWrap.css({'transform' : 'translateX(-270px)'});

    if(triggerID == '#sidebar-pages') {
      paddingAsign();
    }

  });

  backLink.click(function() {
    var prevMenu = $(this).attr('data-prev'),
        container = $(this).parents('.sidebar-container.is-show');
    sidebarWrap.css({'transform' : 'translateX('+ (prevMenu) +'px)'});
    setTimeout(function() {
      container.removeClass('is-show');
    }, 300);
  });
  // Pages sidebar - page click
  $('.pages-sidebar').on('click', '.menu-text span', function() {
    dragdrop.addClass('is-show');
    $(dragdrop).niceScroll({
      cursorborderradius: "0px",
      cursorborder : false,
      cursorcolor:"#000000",
      cursoropacitymax: 0.30,
      horizrailenabled: false,
    }).resize();
    sidebarWrap.css({'transform' : 'translateX(-540px)'});

  });
};
sidebarTrigger();



// Page sidebar - padding-right
$('.pages-sidebar > li').hover(
  function() {
    var iconsWidth = $(this).find('.page-icons').width(),
        link = $(this).children('a').eq(0);
    link.css({"padding-right" : (iconsWidth + 5)});
  },
  function() {
    var iconsWidth = $(this).find('.page-icons').width(),
        link = $(this).children('a').eq(0);
    if(!($(this).find('.page-icons').is('.active'))) {
      link.css({'padding-right' : (iconsWidth - 14)});
    } else {
      return false;
    }
  }
);
function paddingAsign() {

  $('.pages-sidebar > li > a').not('.menu-expand').each(function() {
    var settingsWidth = $(this).find('.page-icons').width();
    $(this).css({'padding-right' : (settingsWidth - 14)});
  });

};

// Page sidebar - menu expand
function menuReveal() {
  $('.pages-sidebar .pages-menu').each(function() {
    var $this = $(this);
    if($this.next('li.pages-submenu').length > 0) {
      $this.addClass('menu-collapse');
    }
  });
  $('.pages-sidebar .pages-submenu').each(function() {
    var $this = $(this);
    if($this.next('li.pages-subsubmenu').length > 0) {
      $this.addClass('menu-collapse');
    }
  });
};
menuReveal();

$('.pages-sidebar').on('click', '.menu-expand', function(e) {
  e.preventDefault();
  var $this = $(this),
      menu = $this.parents('li.menu-collapse');

  if($this.hasClass('active')) {
      $this.removeClass('active');
      menu.nextUntil('.pages-menu').not('.menu-block-divider, .page-add-field').slideUp(150).removeClass('show');
  } else {
    $this.addClass('active');
    $('.page-menu-settings').removeClass('active');
    if(menu.hasClass('pages-menu')) {
      menu.nextUntil('.pages-menu').not('.pages-subsubmenu, .menu-block-divider, .page-add-field').slideDown('fast').addClass('show');
    } else if(menu.hasClass('pages-submenu')) {
      menu.nextUntil('.pages-menu').not('.menu-block-divider, .page-add-field').slideDown('fast').addClass('show');
    }
  }
});

// Page settings
$('.pages-sidebar').on('click', '.page-settings', function() {
  var $this = $(this),
  elements = $('.pages-sidebar .page-settings'),
  allLi = $('.pages-sidebar > li'),
  leftPos = $this.offset().left,
  topPos = $this.offset().top - $(window).scrollTop(),
  width = $this.width(),
  settingsMenu = $('.page-menu-settings'),
  parent = $this.parent(),
  parentWidth = parent.width(),
  parentLi = $this.parents('li'),
  parentLink = parent.prev(),
  overlay = $('.aside-screen-overlay');

  // if not active
  if(!(parent.is('.active'))) {
    // remove other elements 'active' classes
    elements.parent().removeClass('active');
    elements.parents('li').removeClass('active');
    settingsMenu.removeClass('active');
    allLi.each(function() {
      var link = $(this).children('a').eq(0),
      iconWidth = $(this).find('.page-icons').width();
      link.css({"padding-right" : (iconWidth - 14)});
    });
    // add this 'active' status
    parent.addClass('active');
    parentLi.addClass('active');
    parentLink.css({"padding-right" : (parentWidth + 5)});
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    settingsMenu.addClass('active').css({"top" : topPos});
    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      settingsMenu.css({"top" : topPos});
    });
  } else {
    // toggle click
    parent.removeClass('active');
    parentLi.removeClass('active');
    settingsMenu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

$('.sidebar-domains').on('click', '.js-domainsRenews, .js-domainsExpires', function(e) {
  e.preventDefault();
  var $this = $(this),
      buttons = $('.sidebar-domains .domain-settings a'),
      allMenu = $('.renews-menu-settings, .exprice-menu-settings'),
      renewsMenu = $('.renews-menu-settings'),
      expriceMenu = $('.exprice-menu-settings'),
      topPos = $this.offset().top - $(window).scrollTop(),
      overlay = $('.aside-screen-overlay');
  // if not active
  if(!$this.hasClass('active')) {
    buttons.removeClass('active');
    allMenu.removeClass('active');
    $this.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    if($this.hasClass('js-domainsRenews')) {
      renewsMenu.addClass('active').css({"top" : topPos});
    } else if($this.hasClass('js-domainsExpires')) {
      expriceMenu.addClass('active').css({"top" : topPos});
    }
    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      allMenu.css({"top" : topPos});
    });
  } else {
    $this.removeClass('active');
    allMenu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

$('.sidebar-email').on('click', '.js-emailMenu, .js-forwardMenu', function(e) {
  e.preventDefault();
  var $this = $(this),
      buttons = $('.sidebar-email .email-settings a'),
      allMenu = $('.email-menu-settings, .email-forward-settings'),
      emailMenu = $('.email-menu-settings'),
      forwardMenu = $('.email-forward-settings'),
      topPos = $this.offset().top - $(window).scrollTop(),
      overlay = $('.aside-screen-overlay');
  // if not active
  if(!$this.hasClass('active')) {
    buttons.removeClass('active');
    allMenu.removeClass('active');
    $this.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    if($this.hasClass('js-emailMenu')) {
      emailMenu.addClass('active').css({"top" : topPos});
    } else if($this.hasClass('js-forwardMenu')) {
      forwardMenu.addClass('active').css({"top" : topPos});
    }
    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      allMenu.css({"top" : topPos});
    });
  } else {
    $this.removeClass('active');
    allMenu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

$('.sidebar-contributors').on('click', '.js-contributorMenu', function(e) {
  e.preventDefault();
  var $this = $(this),
      buttons = $('.sidebar-contributors .user-settings a'),
      menu = $('.contributor-menu-settings'),
      topPos = $this.offset().top - $(window).scrollTop(),
      overlay = $('.aside-screen-overlay');
  // if not active
  if(!$this.hasClass('active')) {
    buttons.removeClass('active');
    $this.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    menu.addClass('active').css({"top" : topPos});

    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      menu.css({"top" : topPos});
    });
  } else {
    $this.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

$('.sidebar-languages').on('click', '.js-languagesMenu', function(e) {
  e.preventDefault();
  var $this = $(this),
      buttons = $('.sidebar-languages .language-settings a'),
      menu = $('.language-menu-settings'),
      topPos = $this.offset().top - $(window).scrollTop(),
      overlay = $('.aside-screen-overlay');
  // if not active
  if(!$this.hasClass('active')) {
    buttons.removeClass('active');
    $this.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    menu.addClass('active').css({"top" : topPos});

    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      menu.css({"top" : topPos});
    });
  } else {
    $this.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

$('.sidebar-dragdrop').on('click', '.js-slideSettings', function(e) {
  e.preventDefault();
  var $this = $(this),
      buttons = $('.sidebar-dragdrop .slide-settings a'),
      menu = $('.slide-menu-settings'),
      topPos = $this.offset().top - $(window).scrollTop(),
      overlay = $('.aside-screen-overlay');
  // if not active
  if(!$this.hasClass('active')) {
    buttons.removeClass('active');
    $this.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    menu.addClass('active').css({"top" : topPos});

    $('.sidebar-container.is-show').scroll(function() {
      topPos = $this.offset().top - $(window).scrollTop();
      menu.css({"top" : topPos});
    });
  } else {
    $this.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

// Page add menu
$('.pages-sidebar .js-openPageAdd').click(function() {
  var $this = $(this),
  btnTopPos = $this.offset().top - $(window).scrollTop(),
  btnHeight = $this.height() / 2,
  menu = $('.page-add-menu'),
  menuArrow = $('.page-add-menu .choose-menu-arrow'),
  menuHeaderHeight = menu.find('.menu-header').height() / 2,
  posDifference = btnHeight - menuHeaderHeight,
  overlay = $('.aside-screen-overlay');

  if(!$this.is('.active')) {
    var menuTopPos = btnTopPos + posDifference,
        menuHeight = menu.height(),
        menuFull = menuTopPos + menuHeight,
        addTop = 0;

    $this.addClass('active');
    menu.addClass('active');
    overlay.addClass('active');
    $('body').css({'overflow' : 'hidden'});
    menu.css({'top' : (menuTopPos - addTop) + 'px'});
    menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
    $('.sidebar-container.is-show').scroll(function() {
      btnTopPos = $this.offset().top - $(window).scrollTop();
      menuTopPos = btnTopPos + posDifference;
      menu.css({"top" : (menuTopPos - addTop)});
    });

  } else {
    $this.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  }

});

// Spectrum position
$('.rs-sidebar .color-picker .sp-replacer').click(function() {
  var $this = $(this),
      container = $('.sp-container:not(.sp-hidden)'),
      replacerTopPos = $this.offset().top - $(window).scrollTop(),
      replacerHeight = $this.height();

    if($this.is('.sp-active')) {
      // check window position
      var screenHeight = window.innerHeight - 10,
          containerTopPos = replacerTopPos - replacerHeight,
          containerHeight = container.height(),
          containerFull = containerTopPos + containerHeight,
          addTop = 0;

      if(screenHeight < containerFull) {
        addTop = containerFull - screenHeight;
      }
      // console.log(containerArrow);

      container.css({'position' : 'fixed', 'left' : '280px', 'top' : (containerTopPos - addTop) + 'px'});

      $('.sp-container').find('span.sp-arrow').remove();
      container.append('<span class="sp-arrow"><span/>');
      container.find('span.sp-arrow').css({'top' : (replacerHeight + addTop) + 'px'});

      $('.sidebar-container.is-show').scroll(function() {
        replacerTopPos = $this.offset().top - $(window).scrollTop();
        containerTopPos = replacerTopPos - replacerHeight;

        container.css({"top" : (containerTopPos - addTop)});

      });
    } else {
      $('.sp-container').find('span.sp-arrow').remove();
    }
});

$('.modal .color-picker .sp-replacer').click(function() {
  var $this = $(this),
      container = $('.sp-container:not(.sp-hidden)'),
      replacerLeftPos = $this.offset().left + 10,
      replacerTopPos = $this.offset().top - $(window).scrollTop(),
      replacerHeight = $this.height(),
      replacerWidth = $this.width();

    if($this.is('.sp-active')) {
      // check window position
      var screenHeight = window.innerHeight - 10,
          containerTopPos = replacerTopPos - replacerHeight,
          containerLeftPos = replacerLeftPos + replacerWidth,
          containerHeight = container.height(),
          containerFull = containerTopPos + containerHeight,
          addTop = 0;

      if(screenHeight < containerFull) {
        addTop = containerFull - screenHeight;
      }
      // console.log(containerArrow);

      container.css({'position' : 'fixed', 'left' : containerLeftPos + 'px', 'top' : (containerTopPos - addTop) + 'px'});

      $('.sp-container').find('span.sp-arrow').remove();
      container.append('<span class="sp-arrow"><span/>');
      container.find('span.sp-arrow').css({'top' : (replacerHeight + addTop + 5) + 'px'});// 5 - магическое число

      $('.modal.in').scroll(function() {
        replacerTopPos = $this.offset().top - $(window).scrollTop();
        containerTopPos = replacerTopPos - replacerHeight;

        container.css({"top" : (containerTopPos - addTop)});

      });
    } else {
      $('.sp-container').find('span.sp-arrow').remove();
    }
});

// Choose header menu
function chooseHeader() {
  var menu = $('.choose-header-menu'),
      overlay = $('.aside-screen-overlay');


  $('.sidebar-style-editor .js-headerVersion').click(function() {
    var $this = $(this),
    btnTopPos = $this.offset().top - $(window).scrollTop(),
    btnHeight = $this.height() / 2,
    menuArrow = $('.choose-header-menu .choose-menu-arrow'),
    menuHeaderHeight = menu.find('.menu-header').height() / 2,
    posDifference = btnHeight - menuHeaderHeight;

    if(!$this.is('.active')) {
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');
      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });
    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });

  $('.choose-header-menu a').click(function(e) {
    e.preventDefault();
    var $this = $(this),
    value = $this.attr('href'),
    button = $('.sidebar-style-editor .js-headerVersion')
    buttonText = button.find('.js-chooseText');

    buttonText.text(value);
    button.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  });
};
chooseHeader();

// Choose a menu style
function chooseMenuStyle() {
  var menu = $('.choose-menu-style'),
      menuArrow = $('.choose-menu-style .choose-menu-arrow'),
      overlay = $('.aside-screen-overlay');


  $('.sidebar-style-editor .js-menuVersion').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.height() / 2,
        menuHeaderHeight = menu.find('.menu-header').height() / 2,
        posDifference = btnHeight - menuHeaderHeight;

    if(!$this.is('.active')) {
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });

  $('.choose-menu-style a').click(function(e) {
    e.preventDefault();
    var $this = $(this),
    value = $this.attr('href'),
    button = $('.sidebar-style-editor .js-menuVersion'),
    buttonText = button.find('.js-chooseText');

    buttonText.text(value);
    button.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  });
};
chooseMenuStyle();

function chooseBatchStyle() {
  var menu = $('.choose-batch-style'),
      menuArrow = $('.choose-batch-style .choose-menu-arrow'),
      overlay = $('.aside-screen-overlay');

  $('.sidebar-batch .js-batchStyle').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.height() / 2,
        menuHeaderHeight = menu.find('.menu-header').height() / 2,
        posDifference = btnHeight - menuHeaderHeight;

    if(!$this.is('.active')) {
      var screenHeight = window.innerHeight - 12,
      menuTopPos = btnTopPos + posDifference,
      menuHeight = menu.height(),
      menuFull = menuTopPos + menuHeight,
      addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });

  $('.choose-batch-style a').click(function(e) {
    e.preventDefault();
    var $this = $(this),
    value = $this.attr('href'),
    button = $('.sidebar-batch .js-batchStyle')
    buttonText = button.find('.js-chooseText');

    buttonText.text(value);
    button.removeClass('active');
    menu.removeClass('active');
    overlay.removeClass('active');
    $('body').removeAttr('style');
  });
};
chooseBatchStyle();

// Settings - choose address type
function chooseAddressType() {
  var menu = $('.choose-address-type'),
      mailboxMenu = $('.configure-mailbox'),
      forwarderMenu = $('.configure-forwarder'),
      menuArrow = $('.choose-address-type .choose-menu-arrow'),
      allConfigureMenu = $('.choose-address-type, .configure-mailbox, .configure-forwarder'),
      overlay = $('.aside-screen-overlay');

  $('.sidebar-email .js-addEmail').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.outerHeight() / 2,
        menuHeaderHeight = menu.find('.menu-header').outerHeight() / 2,
        posDifference = btnHeight - menuHeaderHeight;
    if(!$this.is('.active')) {
      // remove other menu
      mailboxMenu.removeClass('active');
      forwarderMenu.removeClass('active');
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, allConfigureMenu, addTop);
      });

      // Configure mailbox menu click
      $('.choose-address-type a').click(function(e) {
        e.preventDefault();
        var configure = $(this).attr('data-configure'),
            configureMenu = $('.' + configure);

        menu.removeClass('active');
        menuPosition($this, configureMenu, addTop);
        configureMenu.addClass('active');
        configureMenu.find('.choose-menu-arrow').css({'top' : (menuHeaderHeight + addTop) + 'px'});

      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
      mailboxMenu.removeClass('active');
      forwarderMenu.removeClass('active');
    }
  });
};
chooseAddressType();

// Settings - choose address type
function chooseSlideType() {
  var menu = $('.dnd-layout-add-slide'),
      youtubeMenu = $('.configure-slide-youtube'),
      imageMenu = $('.configure-slide-image'),
      videoMenu = $('.configure-slide-video'),
      menuArrow = $('.dnd-layout-add-slide .choose-menu-arrow'),
      allConfigureMenu = $('.dnd-layout-add-slide, .configure-slide-youtube, .configure-slide-image, .configure-slide-video'),
      overlay = $('.aside-screen-overlay');

  $('.sidebar-dragdrop-layout .js-addSlide').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.outerHeight() / 2,
        menuHeaderHeight = menu.find('.menu-header').outerHeight() / 2,
        posDifference = btnHeight - menuHeaderHeight;
    if(!$this.is('.active')) {
      // remove other menu
      imageMenu.removeClass('active');
      youtubeMenu.removeClass('active');
      videoMenu.removeClass('active');
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, allConfigureMenu, addTop);
      });

      // Configure mailbox menu click
      $('.dnd-layout-add-slide a').click(function(e) {
        e.preventDefault();
        var configure = $(this).attr('data-configure'),
            configureMenu = $('.' + configure),
            menuHeight = configureMenu.height(),
            menuFull = menuTopPos + menuHeight;

        if(screenHeight < menuFull) {
          addTop = menuFull - screenHeight;
        }

        menu.removeClass('active');
        menuPosition($this, configureMenu, addTop);
        configureMenu.addClass('active');
        configureMenu.find('.choose-menu-arrow').css({'top' : (menuHeaderHeight + addTop) + 'px'});

      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
      imageMenu.removeClass('active');
      youtubeMenu.removeClass('active');
      videoMenu.removeClass('active');
    }
  });
};
chooseSlideType();

// Settings - add contributors
function newContributor() {
  var menu = $('.contributor-new'),
      menuArrow = $('.contributor-new .choose-menu-arrow'),
      overlay = $('.aside-screen-overlay'),
      inputPass = menu.find('input.pass-strength');

  $('.sidebar-contributors .js-addContributor').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.outerHeight() / 2,
        menuHeaderHeight = menu.find('.menu-header').outerHeight() / 2,
        posDifference = btnHeight - menuHeaderHeight;
    if(!$this.is('.active')) {
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });
};
newContributor();

// Settings - add domain
function newDomain() {
  var menu = $('.choose-domain-type'),
      menuArrow = $('.choose-domain-type .choose-menu-arrow'),
      overlay = $('.aside-screen-overlay');

  $('.sidebar-domains .js-addDomain').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.outerHeight() / 2,
        menuHeaderHeight = menu.find('.menu-header').outerHeight() / 2,
        posDifference = btnHeight - menuHeaderHeight;
    if(!$this.is('.active')) {
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });
};
newDomain();

function menuPosition($btn, menu, addTop) {
  var btnTopPos = $btn.offset().top - $(window).scrollTop(),
      btnHeight = $btn.outerHeight(),
      menuHeaderHeight = menu.find('.menu-header').outerHeight(),
      posDifference = Math.abs(btnHeight - menuHeaderHeight) / 2,
      screenHeight = window.innerHeight ,
      menuTopPos = btnTopPos - posDifference;
  menu.css({'top' : (menuTopPos - addTop) + 'px'});

};

// Ladda button
$('.save-button').click(function() {
  var menu = $(this).parents('.changes-fixed');
  if(!$(this).hasClass('changes-saved')) {
    var l = Ladda.create( document.querySelector( '.save-button' ) ),
    button = $(this);

    l.start();
    var progress = 0;
    var interval = setInterval( function() {
      progress = Math.min( progress + Math.random() * 0.2, 1 );
      l.setProgress( progress );
      if( progress === 1 ) {
        l.stop();
        clearInterval( interval );
        savedChanges();
      }
    }, 200 );

  } else {
    return false;
  }

  function savedChanges() {
    button.removeClass('btn-warning btn-outline').addClass('btn-success');
    button.children('.ladda-label').html('<i class="gcon gcon-check icon-btn text-darken m-r"></i>Changes saved');
    menu.addClass('changes-saved');
    setTimeout(function() {
      $('.rs-sidebar').css({'padding': '0'});
    }, 1300);
  }

});

// Website's - add language
function newLanguage() {
  var menu = $('.language-new'),
      menuArrow = $('.language-new .choose-menu-arrow'),
      overlay = $('.aside-screen-overlay');

  $('.sidebar-languages .js-addLanguage').click(function() {
    var $this = $(this),
        btnTopPos = $this.offset().top - $(window).scrollTop(),
        btnHeight = $this.outerHeight() / 2,
        menuHeaderHeight = menu.find('.menu-header').outerHeight() / 2,
        posDifference = btnHeight - menuHeaderHeight;
    if(!$this.is('.active')) {
      // check window position
      var screenHeight = window.innerHeight - 12,
          menuTopPos = btnTopPos + posDifference,
          menuHeight = menu.height(),
          menuFull = menuTopPos + menuHeight,
          addTop = 0;

      if(screenHeight < menuFull) {
        addTop = menuFull - screenHeight;
      }

      menuPosition($this, menu, addTop);

      $('body').css({'overflow' : 'hidden'});
      menuArrow.css({'top' : (menuHeaderHeight + addTop) + 'px'});
      $this.addClass('active');
      menu.addClass('active');
      overlay.addClass('active');

      $('.sidebar-container.is-show').scroll(function() {
        menuPosition($this, menu, addTop);
      });

    } else {
      $this.removeClass('active');
      menu.removeClass('active');
      overlay.removeClass('active');
      $('body').removeAttr('style');
    }
  });
};
newLanguage();

// Check document click
$('.sidebar-style-editor > li > a, .sidebar-style-editor .sp-replacer').click(function(e) {
  // hide other menu
  var elements = $('.choose-menu-style, .choose-header-menu, .sidebar-style-editor .js-headerVersion, .sidebar-style-editor .js-menuVersion, .aside-screen-overlay')
  menuLink = $('.sidebar-style-editor > li > a'),
  colorPicker = $('.sp-replacer'),
  colorContainer = $('.sp-container');

  elements.removeClass('active');
  $('body').removeAttr('style');

  if(menuLink.is(e.target) && menuLink.has(e.target).length === 0) {
    colorPicker.removeClass('sp-active');
    colorContainer.addClass('sp-hidden');
  }
});


$(document).on('click', function(e) {

    // sidebars
    var sidebarPages = $('#sidebar-pages'),
    sidebarDragdrop = $('#sidebar-dragdrop'),
    sidebarStyleEditor = $('#sidebar-style-editor'),
    sidebarBatch = $('#sidebar-batch'),
    sidebarEmail = $('#sidebar-email'),
    sidebarContributors = $('#sidebar-contributors'),
    sidebarDomains = $('#sidebar-domains'),
    sidebarLanguages = $('#sidebar-languages');
    // overlay
    var overlay = $('.aside-screen-overlay');

    if(sidebarPages.hasClass('is-show') && !sidebarDragdrop.hasClass('is-show')) {
      // menu add
      var menuAddElements = $('.page-add-menu, .pages-sidebar .js-openPageAdd'),
      menuAdd = $('.page-add-menu');
      // menu settings
      var menuSettingsElements = $('.pages-sidebar .page-settings'),
      settingsMenu = $('.page-menu-settings'),
      settingsIcon = $('.pages-sidebar .page-icons'),
      settingsIconParent = $('.pages-sidebar > li');
      // page-add input check
      var input = $('#page-add-field');

      if(!menuAddElements.is(e.target) && menuAddElements.has(e.target).length === 0) {
        menuAddElements.removeClass('active');
        if(!(menuAdd.is('.active') || settingsMenu.is('.active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        settingsMenu.removeClass('active');
        settingsIcon.removeClass('active');
        settingsIconParent.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!input.is(e.target) && input.has(e.target).length === 0 && !menuAdd.is(e.target) && menuAdd.has(e.target).length === 0) {
        if(!menuAdd.hasClass('active') && input.hasClass('create')) {
          input.removeClass('create');
        }
      }
    } else if(sidebarStyleEditor.hasClass('is-show')) {
      // Menu choose header`
      var menuHeaderElements = $('.choose-header-menu, .sidebar-style-editor .js-headerVersion'),
      menuHeader = $('.choose-header-menu');
      // Mune choose style menu
      var menuChooseMenuElements = $('.choose-menu-style, .sidebar-style-editor .js-menuVersion'),
      menuChooseMenu = $('.sidebar-style-editor .js-menuVersion');
      if(!menuHeaderElements.is(e.target) && menuHeaderElements.has(e.target).length === 0) {
        menuHeaderElements.removeClass('active');
        if(!(menuHeader.hasClass('active') || menuChooseMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuChooseMenuElements.is(e.target) && menuChooseMenuElements.has(e.target).length === 0) {
        menuChooseMenuElements.removeClass('active');
        if(!(menuHeader.hasClass('active') || menuChooseMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      }
    } else if(sidebarBatch.hasClass('is-show')) {
      // Menu choose batch
      var menuBatchElements = $('.choose-batch-style, .sidebar-batch .js-batchStyle'),
      menuBatch = $('.choose-batch-style');
      if(!menuBatchElements.is(e.target) && menuBatchElements.has(e.target).length === 0) {
        menuBatchElements.removeClass('active');
        overlay.removeClass('active');
        $('body').removeAttr('style');
      }
    } else if(sidebarEmail.hasClass('is-show')) {
      // menu add email
      var menuEmailElements = $('.js-addEmail, .choose-address-type, .configure-mailbox, .configure-forwarder'),
      menuAdd = $('.choose-address-type, .configure-mailbox, .configure-forwarder');
      // menu settings
      var menuSettingsElements = $('.email-settings a, .email-menu-settings, .email-forward-settings'),
      settingsMenu = $('.email-menu-settings, .email-forward-settings');
      if(!menuEmailElements.is(e.target) && menuEmailElements.has(e.target).length === 0) {
        menuEmailElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        menuSettingsElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
    } else if(sidebarContributors.hasClass('is-show')) {
      // Menu add contributor
      var menuAddContributorElements = $('.contributor-new, .js-addContributor'),
      menuContributor = $('.contributor-new');
      // Mune contributor settings
      var menuSettingsElements = $('.contributor-menu-settings, .js-contributorMenu'),
      settingsMenu = $('.contributor-menu-settings');
      if(!menuAddContributorElements.is(e.target) && menuAddContributorElements.has(e.target).length === 0) {
        menuAddContributorElements.removeClass('active');
        if(!(menuContributor.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        menuSettingsElements.removeClass('active');
        if(!(menuContributor.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      }
    } else if(sidebarDomains.hasClass('is-show')) {
      // menu add email
      var menuDomainsElements = $('.js-addDomain, .choose-domain-type'),
      menuAdd = $('.choose-domain-type');
      // menu settings
      var menuSettingsElements = $('.domain-settings a'),
      allSetingsElements = $('.domain-settings a, .renews-menu-settings, .exprice-menu-settings'),
      settingsMenu = $('.renews-menu-settings, .exprice-menu-settings');
      if(!menuDomainsElements.is(e.target) && menuDomainsElements.has(e.target).length === 0) {
        menuDomainsElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        allSetingsElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
    } else if(sidebarLanguages.hasClass('is-show')) {
      // menu add language
      var menuLanguageElements = $('.js-addLanguage, .language-new'),
      menuAdd = $('.language-new');
      // menu settings
      var menuSettingsElements = $('.language-settings a, .language-menu-settings'),
      settingsMenu = $('.language-menu-settings');
      if(!menuLanguageElements.is(e.target) && menuLanguageElements.has(e.target).length === 0) {
        menuLanguageElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        menuSettingsElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
    } else if(sidebarDragdrop.hasClass('is-show')) {
      //menu add slide
      var menuSlideElements = $('.js-addSlide, .dnd-layout-add-slide, .configure-slide-image, .configure-slide-video, .configure-slide-youtube'),
          menuAdd = $('.dnd-layout-add-slide, .configure-slide-image, .configure-slide-video, .configure-slide-youtube');
      // menu  slide settings
      var menuSettingsElements = $('.slide-menu-settings, .js-slideSettings'),
      settingsMenu = $('.slide-menu-settings');
      if(!menuSlideElements.is(e.target) && menuSlideElements.has(e.target).length === 0) {
        menuSlideElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
      if(!menuSettingsElements.is(e.target) && menuSettingsElements.has(e.target).length === 0) {
        menuSettingsElements.removeClass('active');
        if(!(menuAdd.hasClass('active') || settingsMenu.hasClass('active'))) {
          overlay.removeClass('active');
          $('body').removeAttr('style');
        }
      };
    }

});
